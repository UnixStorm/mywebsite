<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNIXSTORM</title>

<style>
    body {
        margin: 0;
        padding: 0;
        height: 100vh;
        background: url("arka.jpg") no-repeat center center fixed;
        background-size: cover;
        font-family: Arial;
    }
    .yazi-kutu {
        width: 100%;
        text-align: center;
        margin-top: 20px;
        color: white;
        font-weight: bold;
        text-shadow: 0 0 6px white;
    }
    .vip { color: orange; text-shadow: 0 0 10px orange; }
    .red { color: red; text-shadow: 0 0 10px red; }

    .center-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 300px;
        padding: 20px;
        background: rgba(0, 0, 0, 0.70);
        backdrop-filter: blur(4px);
        border-radius: 12px;
        box-shadow: 0 0 20px black;
        text-align: center;
        color: white;
    }

    input {
        width: 100%;
        padding: 10px;
        margin: 7px 0;
        border: none;
        border-radius: 8px;
        outline: none;
        font-size: 15px;
    }
    button {
        width: 100%;
        padding: 10px;
        margin-top: 8px;
        border: none;
        border-radius: 8px;
        background: #006CFF;
        color: white;
        font-size: 17px;
        font-weight: bold;
        cursor: pointer;
    }
    .link-btn {
        margin-top: 8px;
        display: block;
        color: #ddd;
        cursor: pointer;
        text-decoration: underline;
        font-size: 14px;
    }
    #durum { margin-top: 10px; min-height: 26px; font-size: 14px; }

    #blocker {
        position: fixed;
        inset: 0;
        display: none;
        background: rgba(0,0,0,0.0);
        pointer-events: none;
    }

    #musicBtn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 18px;
        font-size: 18px;
        background: rgba(0,0,0,0.6);
        border: none;
        border-radius: 10px;
        color: white;
        cursor: pointer;
    }
</style>
</head>
<body>

<div class="yazi-kutu">
    Bu site âš” <b>ğğ® ğ¬ğ¢ğ­ğ ğ–£˜ğ”ğğˆÌ‡ğ—ğ’ğ“ğğ‘ğŒğŸ‡¹ğŸ‡·ğŸ‡¹ğŸ‡·</b> á´›á´€Ê€á´€Ò“Ä±É´á´…á´€É´ á´‹á´œÊ€á´œÊŸá´á´œsÌ§á´›á´œÊ€
    <br>
    <span class="vip">ğ˜ƒğ—¶ğ—½_ğ˜‚ğ˜†ğ—²ğ—¹ğ—²ğ—¿ğŸ”± =</span>
    <span class="red"> ğŠğ€ğ€ğ ğ™ğğ‘ğğ€ & ğˆğğ…ğ€ğ™ ğ™ğğ‘ğğ€</span>
</div>

<div class="center-box">

    <!-- KAYIT OL FORMU -->
    <div id="registerForm">
        <h3>KayÄ±t Ol</h3>
        <input type="text" id="regName" placeholder="KullanÄ±cÄ± adÄ±">
        <input type="email" id="regMail" placeholder="E-posta">
        <input type="password" id="regPass" placeholder="Åifre">
        <input type="file" id="regPhoto" accept="image/*">
        <button id="regBtn">KayÄ±t Ol</button>

        <span class="link-btn" id="toLogin">GiriÅŸ yapÄ±n</span>
        <span class="link-btn" id="toReset">Åifremi unuttum</span>
    </div>

    <!-- GÄ°RÄ°Å FORMU -->
    <div id="loginForm" style="display:none;">
        <h3>GiriÅŸ Yap</h3>
        <input type="email" id="loginMail" placeholder="E-posta">
        <input type="password" id="loginPass" placeholder="Åifre">
        <button id="loginBtn">GiriÅŸ Yap</button>

        <span class="link-btn" id="toRegister2">KayÄ±t olmak istiyorum</span>
        <span class="link-btn" id="toReset2">Åifremi unuttum</span>
    </div>

    <!-- ÅÄ°FRE SIFIRLAMA FORMU -->
    <div id="resetForm" style="display:none;">
        <h3>Åifre SÄ±fÄ±rla</h3>
        <input type="email" id="resetMail" placeholder="E-posta">
        <button id="resetBtn">SÄ±fÄ±rla</button>

        <span class="link-btn" id="toLogin2">GiriÅŸe dÃ¶n</span>
    </div>

    <div id="durum"></div>
</div>

<div id="blocker"></div>

<!-- MÃœZÄ°K -->
<button id="musicBtn">â–¶ Oynat</button>
<audio id="bgm">
    <source src="music.m4a" type="audio/mp4">
</audio>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

import {
  getFirestore,
  setDoc,
  getDocs,
  collection,
  query,
  where,
  doc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyC5X_RnBnhy2k-X6Y_lezHgWbgK31Y5Dao",
    authDomain: "unixstorm-9dff8.firebaseapp.com",
    projectId: "unixstorm-9dff8",
    storageBucket: "unixstorm-9dff8.appspot.com",
    messagingSenderId: "787509821542",
    appId: "1:787509821542:web:2b54b5bafee1207edeada7"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

const durum = document.getElementById("durum");
const blocker = document.getElementById("blocker");

function block(){ blocker.style.display="block"; }
function unblock(){ blocker.style.display="none"; }

function toBase64(file){
    return new Promise((resolve,reject)=>{
        const r=new FileReader();
        r.onload=()=>resolve(r.result);
        r.onerror=()=>reject();
        r.readAsDataURL(file);
    });
}

function switchTo(form){
    document.getElementById("registerForm").style.display="none";
    document.getElementById("loginForm").style.display="none";
    document.getElementById("resetForm").style.display="none";
    document.getElementById(form).style.display="block";
}

document.getElementById("toLogin").onclick = ()=>switchTo("loginForm");
document.getElementById("toReset").onclick = ()=>switchTo("resetForm");
document.getElementById("toRegister2").onclick = ()=>switchTo("registerForm");
document.getElementById("toReset2").onclick = ()=>switchTo("resetForm");
document.getElementById("toLogin2").onclick = ()=>switchTo("loginForm");

document.getElementById("regBtn").onclick = async ()=>{

    const ad   = regName.value.trim();
    const mail = regMail.value.trim();
    const pass = regPass.value;
    const foto = regPhoto.files[0];

    if(!ad || !mail || !pass){ durum.textContent="ğ¥ğ®ğ­ğŸğğ§ ğ›ğ¢ğ¥ğ ğ¢ğ¥ğğ«ğ¢ ğğ¤ğ¬ğ¢ğ¤ğ¬ğ¢ğ³ ğ ğ¢ğ«ğ¢ğ§!"; return; }
    if(!foto){ durum.textContent="ğ©ğ«ğ¨ğŸğ¢ğ¥ ğŸğ¨ğ­ğ¨ğ Ì†ğ«ğšğŸÄ± ğ³ğ¨ğ«ğ®ğ§ğ¥ğ®ğğ®ğ«!"; return; }

    try{
        block();
        durum.textContent="ğ›ğ¢ğ¥ğ ğ¢ğ¥ğğ« ğ¤ğ¨ğ§ğ­ğ«ğ¨ğ¥ ğğğ¢ğ¥ğ¢ğ²ğ¨ğ«...";

        const q=query(collection(db,"kullanicilar"), where("kullaniciAdi","==",ad));
        const sp=await getDocs(q);

        if(!sp.empty){
            durum.textContent="Bu kullanÄ±cÄ± adÄ± alÄ±nmÄ±ÅŸ!";
            unblock();
            return;
        }

        durum.textContent="Kğ®ğ¥ğ¥ğšğ§Ä±ğœÄ± ğ¨ğ¥ğ®ğ¬ğ­ğ®ğ«ğ®ğ¥ğ®ğ²ğ¨ğ«...";

        const base64 = await toBase64(foto);
        const cred = await createUserWithEmailAndPassword(auth,mail,pass);

        await setDoc(doc(db,"kullanicilar",cred.user.uid),{
            kullaniciAdi: ad,
            email: mail,
            photoBase64: base64,
            createdAt: new Date().toISOString()
        });

        durum.textContent="BaÅŸarÄ±lÄ±, yÃ¶nlendiriliyorsun...";
        setTimeout(()=> location.href="ana_site.html", 1200);

    }catch(e){
        durum.textContent="Hata: "+e.message;
        unblock();
    }
};

document.getElementById("loginBtn").onclick = async ()=>{
    try{
        block();
        await signInWithEmailAndPassword(auth, loginMail.value, loginPass.value);
        durum.textContent="GiriÅŸ baÅŸarÄ±lÄ±!";
        setTimeout(()=> location.href="ana_site.html", 1200);
    }catch(e){
        durum.textContent="Hata: "+e.message;
        unblock();
    }
};

document.getElementById("resetBtn").onclick = async ()=>{
    try{
        block();
        await sendPasswordResetEmail(auth, resetMail.value);
        durum.textContent="SÄ±fÄ±rlama linki gÃ¶nderildi!";
        setTimeout(()=>unblock(),1200);
    }catch(e){
        durum.textContent="Hata: "+e.message;
        unblock();
    }
};

</script>

<script>
const audio = document.getElementById("bgm");
const btn   = document.getElementById("musicBtn");

btn.onclick = ()=>{
    if(audio.paused){
        audio.play();
        btn.textContent="â¸ Durdur";
    }else{
        audio.pause();
        btn.textContent="â–¶ Oynat";
    }
};
</script>

</body>
    </html>
