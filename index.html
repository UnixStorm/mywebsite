<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UNIXSTORM â€” GiriÅŸ</title>

<!-- Firebase (modular, web v12) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail, updateProfile } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // --- SENÄ°N KONFÄ°GURASYONUN (kopyaladÄ±ÄŸÄ±n) ---
  const firebaseConfig = {
    apiKey: "AIzaSyC5X_RnBnhy2k-X6Y_lezHgWbgK31Y5Dao",
    authDomain: "unixstorm-9dff8.firebaseapp.com",
    projectId: "unixstorm-9dff8",
    storageBucket: "unixstorm-9dff8.firebasestorage.app",
    messagingSenderId: "787509821542",
    appId: "1:787509821542:web:2b54b5bafee1207edeada7",
    measurementId: "G-BQYS1575QZ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Utility: deviceId (basit) -> localStorage
  let deviceId = localStorage.getItem('unix_device_id');
  if (!deviceId) {
    deviceId = 'd_' + Math.random().toString(36).slice(2,12);
    localStorage.setItem('unix_device_id', deviceId);
  }

  // Export small API to window for UI code below:
  window.UNIX = {
    auth, db, deviceId,
    async register(username, email, password) {
      // check device mapping in Firestore
      const devRef = doc(db, 'devices', deviceId);
      const devSnap = await getDoc(devRef);
      if (devSnap.exists()) throw new Error('Bu cihaz zaten bir hesapla iliÅŸkilendirilmiÅŸ.');

      // create account
      const cred = await createUserWithEmailAndPassword(auth, email, password);
      // set displayName
      await updateProfile(cred.user, { displayName: username });
      // save user doc
      const userRef = doc(db, 'users', cred.user.uid);
      await setDoc(userRef, {
        username, email, createdAt: new Date().toISOString(), deviceId
      });
      // map device -> uid
      await setDoc(devRef, { uid: cred.user.uid, createdAt: new Date().toISOString() });
      // send verification email
      await sendEmailVerification(cred.user);
      return cred.user;
    },
    async login(email, password) {
      const cred = await signInWithEmailAndPassword(auth, email, password);
      // enforce email verified
      if (!cred.user.emailVerified) throw new Error('E-posta doÄŸrulanmamÄ±ÅŸ. GÃ¶nderilen doÄŸrulama linkini kullanÄ±n.');
      return cred.user;
    },
    async sendReset(email) {
      await sendPasswordResetEmail(auth, email);
    }
  };

</script>

<style>
  :root{
    --card-w:360px;
    --accent: #00d1ff;
    --bg: #000;
    --glass: rgba(8,8,10,0.72);
    --neon: 0 0 24px rgba(0,209,255,.35);
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:#000;color:#fff}

  /* ARKA PLAN: resim dosya adÄ±nÄ± BURADA deÄŸiÅŸtir */
  body{
    background: url("3cc68b3f22ff5463843e82b661033950.jpg") center/cover no-repeat fixed;
  }

  /* ÃœSTTE neon yazÄ± (saÄŸ Ã¼st kÃ¼Ã§Ã¼k, saydam) */
  .watermark {
    position:fixed; right:12px; top:12px;
    font-size:12px; color:rgba(255,165,0,.9);
    padding:6px 10px; background:rgba(0,0,0,.25);
    border-radius:6px; backdrop-filter: blur(4px);
    box-shadow: 0 0 18px rgba(255,165,0,.12);
    z-index:999;
    opacity:.85;
  }

  /* ÃœST PARILTILI Ã‡OK BAÅLIK (orta Ã¼st) */
  .titleTop {
    position:fixed; left:50%; transform:translateX(-50%); top:34px;
    text-align:center; color:#ffb56b; font-weight:700; letter-spacing:1px;
    text-shadow: 0 0 12px rgba(255,165,0,.25);
    z-index: 900;
    font-size:18px;
  }

  /* ORTA KUTU */
  .card {
    width:var(--card-w);
    max-width:92%;
    padding:20px;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(12,12,14,.78), rgba(12,12,14,.68));
    margin:0 auto;
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
    box-shadow: 0 6px 30px rgba(0,0,0,.6), var(--neon);
    border: 1px solid rgba(0,209,255,.12);
  }
  .card h2{margin:0 0 12px 0;font-size:18px;font-weight:700;text-align:center}
  .input{width:100%;padding:10px;border-radius:6px;border:0;margin:8px 0;background:#fff;color:#000}
  .btn{display:block;width:100%;padding:10px;border-radius:8px;border:0;background:#00a6ff;color:#fff;font-weight:700;cursor:pointer}
  .link{display:block;margin-top:8px;text-align:center;color:rgba(255,255,255,.7);font-size:13px;cursor:pointer}
  .small{font-size:12px;color:rgba(255,255,255,.65);text-align:center;margin-top:8px}

  /* modal notifications */
  .notice{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:rgba(0,0,0,.6);padding:10px 16px;border-radius:10px;border:1px solid rgba(255,255,255,.06);color:#fff;display:none;z-index:9999}

  /* responsive */
  @media (max-width:420px){
    .titleTop{font-size:14px;top:18px}
  }
</style>
</head>
<body>

  <!-- saÄŸ Ã¼st kÃ¼Ã§Ã¼k suluboya yazÄ± -->
  <div class="watermark">bu site Åahin (9/A Amp) tarafÄ±ndan kurulmuÅŸtur</div>

  <!-- Ã¼st bÃ¼yÃ¼k baÅŸlÄ±k -->
  <div class="titleTop">
    creater: ğ–£˜ğ”ğğˆÌ‡ğ—ğ’ğ“ğğ‘ğŒ<br>
    gardaÅŸlarÄ±m: à¼’ğˆğğ…ğ€ğ™ğ™ğğ‘ğğ€ Â· à¼’ğŠğ€ğ€ğ ğ™ğğ‘ğğ€
  </div>

  <!-- GiriÅŸ / KayÄ±t KUTUSU -->
  <div class="card" id="card">
    <h2 id="cardTitle">UNIXSTORM â€” KayÄ±t Ol</h2>

    <!-- kayÄ±t alanÄ± -->
    <input id="username" class="input" placeholder="KullanÄ±cÄ± adÄ± (her ÅŸey serbest)" />
    <input id="email" class="input" placeholder="E-posta (kod gÃ¶nderilecek)" />
    <input id="password" class="input" placeholder="Åifre" type="password" />

    <button id="actionBtn" class="btn">KayÄ±t Ol</button>
    <div class="link" id="toggleLogin">HesabÄ±n var mÄ±? GiriÅŸ yap</div>
    <div class="small"><a id="forgot" style="color:lightblue;cursor:pointer">Åifremi unuttum</a></div>
    <div class="small" style="margin-top:10px;font-size:12px;color:rgba(255,255,255,.6)">
      Not: KayÄ±t olunca doÄŸrulama e-postasÄ± gelecek. DoÄŸruladÄ±ktan sonra giriÅŸ yapabilirsiniz.
    </div>
  </div>

  <div class="notice" id="notice">UyarÄ±</div>

<script type="module">
  // UI select
  const cardTitle = document.getElementById('cardTitle');
  const usernameEl = document.getElementById('username');
  const emailEl = document.getElementById('email');
  const passwordEl = document.getElementById('password');
  const actionBtn = document.getElementById('actionBtn');
  const toggleLogin = document.getElementById('toggleLogin');
  const forgotLink = document.getElementById('forgot');
  const notice = document.getElementById('notice');

  // get window.UNIX from module above
  const { register, login, sendReset, deviceId } = window.UNIX;

  let mode = 'register'; // or 'login'

  function showNotice(text, duration=3000){
    notice.textContent = text;
    notice.style.display = 'block';
    setTimeout(()=> notice.style.display='none', duration);
  }

  // switch mode UI
  function setMode(m){
    mode = m;
    if (m === 'register'){
      cardTitle.textContent = 'UNIXSTORM â€” KayÄ±t Ol';
      actionBtn.textContent = 'KayÄ±t Ol';
      usernameEl.style.display = 'block';
      toggleLogin.textContent = 'HesabÄ±n var mÄ±? GiriÅŸ yap';
    } else {
      cardTitle.textContent = 'UNIXSTORM â€” GiriÅŸ Yap';
      actionBtn.textContent = 'GiriÅŸ Yap';
      usernameEl.style.display = 'none';
      toggleLogin.textContent = 'HesabÄ±n yok mu? KayÄ±t ol';
    }
  }
  setMode('register');

  toggleLogin.addEventListener('click', ()=> {
    setMode(mode==='register' ? 'login':'register');
  });

  // forgot password
  forgotLink.addEventListener('click', async ()=>{
    const email = prompt('E-posta adresini gir (ÅŸifre sÄ±fÄ±rlama maili gÃ¶nderilecek):');
    if (!email) return;
    try{
      await sendReset(email);
      showNotice('SÄ±fÄ±rlama e-postasÄ± gÃ¶nderildi. Gelen kutunu kontrol et.');
    }catch(e){
      showNotice('Hata: '+ (e.message || e));
    }
  });

  // action button (register or login)
  actionBtn.addEventListener('click', async ()=>{
    const username = usernameEl.value.trim();
    const email = emailEl.value.trim();
    const pwd = passwordEl.value;

    if (mode === 'register'){
      if (!username) { showNotice('KullanÄ±cÄ± adÄ± gir.'); return; }
      if (!email || !pwd) { showNotice('E-posta ve ÅŸifre gerekli.'); return; }
      try{
        actionBtn.disabled = true;
        showNotice('KayÄ±t yapÄ±lÄ±yor...');
        const user = await register(username, email, pwd);
        showNotice('KayÄ±t baÅŸarÄ±lÄ±. DoÄŸrulama maili gÃ¶nderildi.');
        // after register ask user to check mail
      }catch(e){
        showNotice('Hata: ' + (e.message || e));
      }finally{ actionBtn.disabled = false; }
    } else {
      if (!email || !pwd) { showNotice('E-posta ve ÅŸifre gerekli.'); return; }
      try{
        actionBtn.disabled = true;
        showNotice('GiriÅŸ deneniyor...');
        const user = await login(email, pwd);
        showNotice('GiriÅŸ baÅŸarÄ±lÄ±! yÃ¶nlendiriliyorsun...');
        // redirect to protected main page (create main.html later)
        setTimeout(()=>{ window.location.href = '/main.html'; }, 900);
      }catch(e){
        showNotice('Hata: ' + (e.message || e));
      }finally{ actionBtn.disabled = false; }
    }
  });

  // Optional: show deviceId in console
  console.log('deviceId:', deviceId);

</script>
</body>
</html>
