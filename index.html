<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNIXSTORM</title>
<style>
    body {
        margin: 0;
        padding: 0;
        height: 100vh;
        background: url("3cc68b3f22ff5463843e82b661033950.jpg") no-repeat center center fixed;
        background-size: cover;
        font-family: "Arial";
    }
    .yazi-kutu {
        width: 100%;
        text-align: center;
        margin-top: 28px;
    }
    .anaYazi {
        font-size: 18px;
        color: white;
        font-weight: bold;
        text-shadow: 0 0 6px white, 0 0 14px white;
    }
    .vip {
        color: orange;
        font-size: 17px;
        text-shadow: 0 0 6px orange, 0 0 15px orange;
        font-weight: bold;
    }
    .red {
        color: red;
        font-weight: bold;
        text-shadow: 0 0 6px red, 0 0 15px red;
    }

    /* KUTU KÃœÃ‡ÃœLTÃœLDÃœ */
    .center-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 280px;              /* kÃ¼Ã§Ã¼ltÃ¼ldÃ¼ */
        padding: 18px;             /* biraz azaltÄ±ldÄ± */
        background: rgba(0,0,0,0.78);
        backdrop-filter: blur(5px);
        border-radius: 12px;
        box-shadow: 0 0 22px rgba(0,0,0,0.65);
        text-align: center;
        color: white;
        overflow: visible;
    }

    .center-box h3 { margin: 0 0 12px 0; font-size: 22px; }

    .center-box input {
        width: 100%;
        padding: 10px;
        margin: 6px 0;
        border-radius: 8px;
        border: none;
        outline: none;
        box-sizing: border-box;
        font-size: 15px;
    }

    .center-box button {
        width: 100%;
        padding: 10px;
        margin-top: 8px;
        border: none;
        border-radius: 8px;
        background: #006CFF;
        color: white;
        font-weight: bold;
        cursor: pointer;
        font-size: 16px;
    }

    .link-btn {
        margin-top: 8px;
        display: block;
        color: #ddd;
        cursor: pointer;
        text-decoration: underline;
        font-size: 14px;
    }

    #durum {
        margin-top: 10px;
        font-size: 14px;
        min-height: 22px;
        color: #fff;
    }

    /* overlay (iÅŸlem sÄ±rasÄ±nda tÄ±klamayÄ± kapatmak iÃ§in) */
    #blocker {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.0);
      z-index: 9999;
      display: none;
      pointer-events: none;
    }

    /* basit gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ sorunsuz hale getirmek iÃ§in */
    .hidden { display: none; }
</style>
</head>
<body>

<div class="yazi-kutu">
    <div class="anaYazi">
        ğğ® ğ¬ğ¢ğ­ğ ğ–£˜ğ”ğğˆğ—ğ’ğ“ğğ‘ğŒğŸ‡¹ğŸ‡· á´›á´€Ê€á´€Ò“Ä±É´á´…á´€É´ á´‹á´œÊ€á´œÊŸá´á´œsÌ§á´›á´œÊ€
    </div>
    <div style="margin-top: 6px;">
        <span class="vip">ğ˜ƒğ—¶ğ—½_ğ˜‚ğ˜†ğ—²ğ—¹ğ—²ğ—¿ğŸ”± = </span>
        <span class="red">ğŠğ€ğ€ğ ğ™ğğ‘ğğ€ & ğˆğğ…ğ€ğ™ ğ™ğğ‘ğğ€</span>
    </div>
</div>

<!-- FORM KUTUSU -->
<div class="center-box">

  <!-- KayÄ±t Formu -->
  <div id="registerForm">
    <h3>KayÄ±t Ol</h3>
    <input type="text" id="regName" placeholder="KullanÄ±cÄ± adÄ±">
    <input type="email" id="regMail" placeholder="E-posta">
    <input type="password" id="regPass" placeholder="Åifre">
    <!-- PROFIL FOTOÄRAF YÃœKLEME -->
    <input type="file" id="regPhoto" accept="image/*">
    <button id="regBtn">KayÄ±t Ol</button>
    <span class="link-btn" id="toLogin">GiriÅŸ yapÄ±n</span>
    <span class="link-btn" id="toReset">Åifremi unuttum</span>
  </div>

  <!-- GiriÅŸ Formu -->
  <div id="loginForm" style="display:none;">
    <h3>GiriÅŸ Yap</h3>
    <input type="email" id="loginMail" placeholder="E-posta">
    <input type="password" id="loginPass" placeholder="Åifre">
    <button id="loginBtn">GiriÅŸ Yap</button>
    <span class="link-btn" id="toRegisterFromLogin">KayÄ±t olmak istiyorum</span>
    <span class="link-btn" id="toResetFromLogin">Åifremi unuttum</span>
  </div>

  <!-- Åifre SÄ±fÄ±rlama -->
  <div id="resetForm" style="display:none;">
    <h3>Åifre SÄ±fÄ±rla</h3>
    <input type="email" id="resetMail" placeholder="E-posta">
    <button id="resetBtn">SÄ±fÄ±rlama linki gÃ¶nder</button>
    <span class="link-btn" id="toLoginFromReset">GiriÅŸe dÃ¶n</span>
  </div>

  <!-- burada durum / lÃ¼tfen bekleyiniz yazÄ±larÄ± gÃ¶sterilir -->
  <div id="durum"></div>
</div>

<!-- overlay: iÅŸlem sÄ±rasÄ±nda tÄ±klanmayÄ± engellemek iÃ§in -->
<div id="blocker" aria-hidden="true"></div>

<!-- --- FIREBASE --- -->
<script type="module">
/* Firebase imports */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendPasswordResetEmail
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

import {
  getFirestore,
  setDoc,
  getDocs,
  collection,
  query,
  where,
  doc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

import {
  getStorage,
  ref,
  uploadBytes,
  getDownloadURL
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

/* --- Config --- (senin verdiÄŸin) */
const firebaseConfig = {
    apiKey: "AIzaSyC5X_RnBnhy2k-X6Y_lezHgWbgK31Y5Dao",
    authDomain: "unixstorm-9dff8.firebaseapp.com",
    projectId: "unixstorm-9dff8",
    storageBucket: "unixstorm-9dff8.firebasestorage.app",
    messagingSenderId: "787509821542",
    appId: "1:787509821542:web:2b54b5bafee1207edeada7",
    measurementId: "G-BQYS1575QZ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);
const storage = getStorage(app);

/* Elemanlar */
const durum = document.getElementById("durum");
const blocker = document.getElementById("blocker");
const regBtn = document.getElementById("regBtn");
const loginBtn = document.getElementById("loginBtn");
const resetBtn = document.getElementById("resetBtn");

/* linkleri baÄŸla (form geÃ§iÅŸleri) */
document.getElementById("toLogin").onclick = ()=> formDegistir('login');
document.getElementById("toReset").onclick = ()=> formDegistir('reset');
document.getElementById("toRegisterFromLogin").onclick = ()=> formDegistir('register');
document.getElementById("toResetFromLogin").onclick = ()=> formDegistir('reset');
document.getElementById("toLoginFromReset").onclick = ()=> formDegistir('login');

/* helper: promise iÃ§in timeout (ms) */
function withTimeout(promise, ms) {
  const timeout = new Promise((_, rej) => setTimeout(() => rej(new Error("Ä°ÅŸlem zaman aÅŸÄ±mÄ±na uÄŸradÄ±.")), ms));
  return Promise.race([promise, timeout]);
}

/* Form geÃ§iÅŸi: Ã¶nce "LÃ¼tfen bekleyiniz..." gÃ¶ster, 3s sonra deÄŸiÅŸtir */
async function formDegistir(target) {
  // Temizle ve blokla
  durum.textContent = "LÃ¼tfen bekleyiniz...";
  blockUI();
  // garanti 3s bekle
  await new Promise(res => setTimeout(res, 3000));
  // sonra formu deÄŸiÅŸtir
  document.getElementById("registerForm").style.display = "none";
  document.getElementById("loginForm").style.display = "none";
  document.getElementById("resetForm").style.display = "none";
  document.getElementById(target + "Form").style.display = "block";
  // durum temizle ve unblock
  durum.textContent = "";
  unblockUI();
}

/* UI bloklama helper */
function blockUI() {
  blocker.style.display = "block";
  blocker.style.pointerEvents = "auto";
}
function unblockUI() {
  blocker.style.display = "none";
  blocker.style.pointerEvents = "none";
}

/* ---------- KAYIT (register) ---------- */
regBtn.onclick = async function(){
  const ad = document.getElementById("regName").value.trim();
  const mail = document.getElementById("regMail").value.trim();
  const pass = document.getElementById("regPass").value;
  const foto = document.getElementById("regPhoto").files[0];

  if(!ad || !mail || !pass){
    durum.textContent = "LÃ¼tfen tÃ¼m alanlarÄ± doldurun.";
    return;
  }

  try {
    // kontrol ediliyor 3s sabit (kullanÄ±cÄ± baÅŸka iÅŸlem yapamaz)
    blockUI();
    durum.textContent = "Kontrol ediliyor...";
    await new Promise(res => setTimeout(res, 3000));

    // kullanÄ±cÄ± adÄ± kontrolÃ¼ (db sorgusu iÃ§in 6s timeout)
    const q = query(collection(db, "kullanicilar"), where("kullaniciAdi", "==", ad));
    const snapshot = await withTimeout(getDocs(q), 6000).catch(err => { throw err; });

    if (!snapshot.empty) {
      durum.textContent = "âš  Bu kullanÄ±cÄ± adÄ± zaten kullanÄ±lÄ±yor!";
      unblockUI();
      return;
    }

    // kayÄ±t baÅŸlatÄ±lÄ±yor (en fazla 6s iÃ§inde tamamlanmasÄ± beklenir)
    durum.textContent = "KayÄ±t yapÄ±lÄ±yor...";
    // createUser ve upload iÅŸlemlerini sÄ±rasÄ±yla Ã§alÄ±ÅŸtÄ±racaÄŸÄ±z ama her adÄ±m iÃ§in timeout uygulayacaÄŸÄ±z

    const cred = await withTimeout(createUserWithEmailAndPassword(auth, mail, pass), 6000).catch(err => { throw err; });

    let photoURL = "";
    if (foto) {
      const storageRef = ref(storage, "profilFoto/" + cred.user.uid);
      await withTimeout(uploadBytes(storageRef, foto), 6000).catch(err => { throw err; });
      photoURL = await withTimeout(getDownloadURL(storageRef), 6000).catch(err => { throw err; });
    }

    // firestore kaydÄ± (zaman aÅŸÄ±mÄ± uygulanabilir)
    await withTimeout(setDoc(doc(db, "kullanicilar", cred.user.uid), {
      kullaniciAdi: ad,
      email: mail,
      photoURL: photoURL,
      createdAt: new Date().toISOString()
    }), 6000).catch(err => { throw err; });

    // baÅŸarÄ±: kullanÄ±cÄ±yÄ± 5s gÃ¶sterip yÃ¶nlendir
    durum.textContent = "âœ” Hesap oluÅŸturuldu, yÃ¶nlendiriliyorsunuz...";
    await new Promise(res => setTimeout(res, 5000));
    location.href = "ana_site.html";

  } catch(e) {
    // hata: gÃ¶ster, unblock et
    durum.textContent = "Hata: " + (e.message || e.toString());
    unblockUI();
  }
};

/* ---------- GÄ°RÄ°Å (login) ---------- */
loginBtn.onclick = async function(){
  const mail = document.getElementById("loginMail").value.trim();
  const pass = document.getElementById("loginPass").value;

  if(!mail || !pass){
    durum.textContent = "LÃ¼tfen e-posta ve ÅŸifre girin.";
    return;
  }

  try {
    blockUI();
    durum.textContent = "GiriÅŸ yapÄ±lÄ±yor...";
    // giriÅŸ iÅŸlemi max 6s; sonra hata verir
    await withTimeout(signInWithEmailAndPassword(auth, mail, pass), 6000);
    durum.textContent = "âœ” GiriÅŸ baÅŸarÄ±lÄ±, yÃ¶nlendiriliyorsunuz...";
    await new Promise(res => setTimeout(res, 5000));
    location.href = "ana_site.html";
  } catch(e) {
    durum.textContent = "Hata: " + (e.message || e.toString());
    unblockUI();
  }
};

/* ---------- ÅÄ°FRE SIFIRLAMA ---------- */
resetBtn.onclick = async function(){
  const mail = document.getElementById("resetMail").value.trim();
  if(!mail){
    durum.textContent = "LÃ¼tfen e-posta girin.";
    return;
  }

  try {
    blockUI();
    durum.textContent = "Kontrol ediliyor...";
    // 3s kontrol sabiti
    await new Promise(res => setTimeout(res, 3000));

    // kontrol: bu epostaya kayÄ±tlÄ± kullanÄ±cÄ± var mÄ±? (max 6s)
    const q = query(collection(db, "kullanicilar"), where("email", "==", mail));
    const snapshot = await withTimeout(getDocs(q), 6000).catch(err => { throw err; });

    if (snapshot.empty) {
      durum.textContent = "Bu e-posta ile kayÄ±tlÄ± kullanÄ±cÄ± bulunamadÄ±.";
      unblockUI();
      return;
    }

    // reset mail gÃ¶nder (max 6s)
    await withTimeout(sendPasswordResetEmail(auth, mail), 6000).catch(err => { throw err; });
    durum.textContent = "âœ” SÄ±fÄ±rlama linki gÃ¶nderildi! E-postadaki linkten ÅŸifrenizi deÄŸiÅŸtirebilirsiniz.";
    await new Promise(res => setTimeout(res, 4000));
    unblockUI();

  } catch(e) {
    durum.textContent = "Hata: " + (e.message || e.toString());
    unblockUI();
  }
};

/* ---------- MÃœZÄ°K BUTONU ---------- */
/* MÃ¼zik dosyan music.m4a olarak repoda olmalÄ± (kullanÄ±cÄ± aÃ§Ä±nca Ã§alar). */
const audio = document.getElementById("bgm");
const btn = document.getElementById("musicBtn");
btn.onclick = () => {
  if (audio.paused) {
    audio.play().catch(()=>{ /* autoplay blocked */ });
    btn.textContent = "â¸ Durdur";
  } else {
    audio.pause();
    btn.textContent = "â–¶ Oynat";
  }
};

/* Sayfa yÃ¼klendiÄŸinde overlay kapalÄ± olsun */
unblockUI();

</script>

<!-- MÃœZÄ°K BUTONU -->
<button id="musicBtn" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 12px 20px;
    font-size: 18px;
    border: none;
    border-radius: 10px;
    background: rgba(0,0,0,0.6);
    color: white;
    cursor: pointer;
">â–¶ Oynat</button>

<audio id="bgm">
    <source src="music.m4a" type="audio/mp4">
</audio>

</body>
</html>
