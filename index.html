<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNIXSTORM</title>

<style>
body{
    margin:0;padding:0;height:100vh;
    background:url("3cc68b3f22ff5463843e82b661033950.jpg") no-repeat center center fixed;
    background-size:cover;font-family:Arial;
}
.center-box{
    position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
    width:280px;padding:20px;background:rgba(0,0,0,0.78);
    border-radius:12px;color:white;text-align:center;
}
.center-box input,button{
    width:100%;padding:10px;margin:6px 0;border:none;border-radius:8px;
}
button{background:#006CFF;color:white;font-weight:bold}
.link-btn{display:block;margin-top:6px;color:#ddd;cursor:pointer}
#durum{margin-top:10px;font-weight:bold}
</style>
</head>

<body>

<div class="center-box">

<!-- RESET 1 -->
<div id="resetMailBox">
<h3>Şifreyi Sıfırla</h3>
<input id="resetMail" type="email" placeholder="E-posta">
<button id="sendCodeBtn">Kodu Gönder</button>
<span class="link-btn" onclick="showLogin()">Girişe dön</span>
</div>

<!-- RESET 2 -->
<div id="resetCodeBox" style="display:none">
<h3>Kodu Gir</h3>
<input id="resetCode" placeholder="6 haneli kod">
<button id="checkCodeBtn">Kodu Doğrula</button>
</div>

<!-- RESET 3 -->
<div id="newPassBox" style="display:none">
<h3>Yeni Şifre</h3>
<input id="newPass" type="password" placeholder="Yeni şifre">
<button id="savePassBtn">Şifreyi Güncelle</button>
</div>

<div id="durum"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import {
getAuth,
signInWithEmailAndPassword,
updatePassword
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

const firebaseConfig = {
apiKey: "AIzaSyC5X_RnBnhy2k-X6Y_lezHgWbgK31Y5Dao",
authDomain: "unixstorm-9dff8.firebaseapp.com",
projectId: "unixstorm-9dff8",
storageBucket: "unixstorm-9dff8.firebasestorage.app",
messagingSenderId: "787509821542",
appId: "1:787509821542:web:2b54b5bafee1207edeada7"
};

initializeApp(firebaseConfig);
const auth = getAuth();

emailjs.init("dCQownkzENRARtTC_");

let resetKod = null;
let resetEmail = null;

/* 1️⃣ MAIL GÖNDER */
sendCodeBtn.onclick = async () => {
  resetEmail = resetMail.value;
  resetKod = Math.floor(100000 + Math.random() * 900000);

  await emailjs.send(
    "service_vbm28pq",
    "template_507m11j",
    { kod: resetKod, mail: resetEmail }
  );

  durum.textContent = "Mail gönderildi";
  resetMailBox.style.display = "none";
  resetCodeBox.style.display = "block";
};

/* 2️⃣ KOD KONTROL */
checkCodeBtn.onclick = () => {
  if (resetCode.value != resetKod) {
    durum.textContent = "Kod yanlış";
    return;
  }
  durum.textContent = "Kod doğru";
  setTimeout(() => {
    resetCodeBox.style.display = "none";
    newPassBox.style.display = "block";
  }, 2000);
};

/* 3️⃣ ŞİFRE GÜNCELLE */
savePassBtn.onclick = async () => {
  try {
    await signInWithEmailAndPassword(auth, resetEmail, "TEMP_LOGIN");
  } catch {}

  const user = auth.currentUser;
  await updatePassword(user, newPass.value);

  durum.textContent = "Şifre güncellendi";
  setTimeout(() => location.href = "index.html", 2000);
};

function showLogin(){
  location.href="index.html";
}
</script>

</body>
</html>
