<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNIXSTORM</title>

<style>
body{margin:0;padding:0;height:100vh;
background:url("3cc68b3f22ff5463843e82b661033950.jpg") no-repeat center center fixed;
background-size:cover;font-family:Arial;}
.yazi-kutu{text-align:center;margin-top:28px;}
.anaYazi{font-size:18px;color:white;font-weight:bold;text-shadow:0 0 6px white;}
.vip{color:orange;font-weight:bold;text-shadow:0 0 6px orange;}
.red{color:red;font-weight:bold;text-shadow:0 0 6px red;}

.center-box{
position:fixed;top:50%;left:50%;
transform:translate(-50%,-50%);
width:280px;padding:20px;background:rgba(0,0,0,0.78);
border-radius:12px;backdrop-filter:blur(5px);color:white;text-align:center;
}
.center-box input{
width:100%;padding:10px;margin:6px 0;border:none;border-radius:8px;outline:none;
}
.center-box button{
width:100%;padding:10px;margin-top:8px;border:none;border-radius:8px;
background:#006CFF;font-weight:bold;color:white;cursor:pointer;
}
.link-btn{
display:block;margin-top:8px;text-decoration:underline;
color:#ddd;cursor:pointer;
}
#durum{
margin-top:10px;min-height:22px;color:#ffebeb;font-weight:bold;font-size:14px;
}

/* OVERLAY */
#overlay{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.55);display:none;
justify-content:center;align-items:center;z-index:99999;
}
.loaderBox{
background:rgba(0,0,0,0.80);padding:20px 30px;border-radius:12px;
text-align:center;color:white;font-size:18px;font-weight:bold;box-shadow:0 0 10px black;
}
.loader{
border:4px solid #fff;border-top:4px solid transparent;border-radius:50%;
width:40px;height:40px;animation:load 1s linear infinite;margin:0 auto 15px auto;
}
@keyframes load{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>

<body>

<!-- OVERLAY -->
<div id="overlay">
    <div class="loaderBox">
        <div class="loader"></div>
        LÃ¼tfen bekleyiniz...
    </div>
</div>

<div class="yazi-kutu">
    <div class="anaYazi">ğğ® ğ¬ğ¢ğ­ğ ğ–£˜ğ”ğğˆğ—ğ’ğ“ğğ‘ğŒğŸ‡¹ğŸ‡· (ğ—¦ğ—”ğ—›ğ—¢ ğ—¥ğ—˜ğ—œğ—¦) á´›á´€Ê€á´€Ò“Ä±É´á´…á´€É´ á´‹á´œÊ€á´œÊŸá´á´œsÌ§á´›á´œÊ€</div>
    <div><span class="vip">ğ˜ƒğ—¶ğ—½_ğ˜‚ğ˜†ğ—²ğ—¹ğ—²ğ—¿ğŸ”± = </span><span class="red">ğŠğ€ğ€ğ ğ™ğğ‘ğğ€ & ğˆğğ…ğ€ğ™ ğ™ğğ‘ğğ€</span></div>
</div>

<div class="center-box">

<!-- KAYIT -->
<div id="registerForm">
    <h3>KayÄ±t Ol</h3>
    <input id="regName" placeholder="KullanÄ±cÄ± adÄ±">
    <input id="regMail" type="email" placeholder="E-posta">
    <input id="regPass" type="password" placeholder="Åifre">
    <input id="regCode" placeholder="E-postaya gelen kod">
    <button id="regBtn">KayÄ±t Ol</button>
    <span class="link-btn" id="toLogin">GiriÅŸ yapÄ±n</span>
    <span class="link-btn" id="toReset">Åifremi unuttum</span>
</div>

<!-- GÄ°RÄ°Å -->
<div id="loginForm" style="display:none;">
    <h3>GiriÅŸ Yap</h3>
    <input id="loginMail" type="email" placeholder="E-posta">
    <input id="loginPass" type="password" placeholder="Åifre">
    <button id="loginBtn">GiriÅŸ Yap</button>
    <span class="link-btn" id="toRegister">KayÄ±t Ol</span>
    <span class="link-btn" id="toReset2">Åifremi unuttum</span>
</div>

<!-- SIFIRLAMA -->
<div id="resetForm" style="display:none;">
    <h3>Åifreyi SÄ±fÄ±rla</h3>
    <input id="resetMail" type="email" placeholder="E-posta">
    <button id="resetBtn">Kodu GÃ¶nder</button>
    <span class="link-btn" id="toLogin2">GiriÅŸe dÃ¶n</span>
</div>

<!-- KOD -->
<div id="resetCodeForm" style="display:none;">
    <h3>Kod DoÄŸrula</h3>
    <input id="resetCode" placeholder="Kod">
    <button id="resetCodeBtn">DoÄŸrula</button>
</div>

<!-- YENÄ° ÅÄ°FRE -->
<div id="newPassForm" style="display:none;">
    <h3>Yeni Åifre</h3>
    <input id="newPass" type="password" placeholder="Yeni ÅŸifre">
    <button id="newPassBtn">Kaydet</button>
</div>

<div id="durum"></div>
</div>

<!-- MÃœZÄ°K -->
<button id="musicBtn" style="position:fixed;bottom:20px;right:20px;
padding:12px 20px;font-size:18px;border:none;border-radius:10px;
background:rgba(0,0,0,0.6);color:white;cursor:pointer;">
â–¶ Oynat
</button>

<audio id="bgm">
    <source src="music.m4a" type="audio/mp4">
</audio>

<!-- EMAILJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>emailjs.init("dCQownkzENRARtTC_");</script>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyC5X_RnBnhy2k-X6Y_lezHgWbgK31Y5Dao",
    authDomain: "unixstorm-9dff8.firebaseapp.com",
    projectId: "unixstorm-9dff8",
    storageBucket: "unixstorm-9dff8.firebasestorage.app",
    messagingSenderId: "787509821542",
    appId: "1:787509821542:web:2b54b5bafee1207edeada7",
    databaseURL: "https://unixstorm-9dff8-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ------------------------------ SHA-256 ------------------------------ */
async function sha256(text){
    const data = new TextEncoder().encode(text);
    const hash = await crypto.subtle.digest("SHA-256", data);
    return Array.from(new Uint8Array(hash))
        .map(b => b.toString(16).padStart(2,"0"))
        .join("");
}

/* -------------------------------------------------- */
/* FORM GEÃ‡Ä°Å / OVERLAY */
/* -------------------------------------------------- */
const overlay = document.getElementById("overlay");
const durum = document.getElementById("durum");

function kilitAc(){ overlay.style.display="flex"; }
function kilitKapat(){ overlay.style.display="none"; }

function formGizle(){
    ["registerForm","loginForm","resetForm","resetCodeForm","newPassForm"]
    .forEach(id=> document.getElementById(id).style.display="none");
}
function formAc(id){
    formGizle();
    document.getElementById(id).style.display="block";
}
function gecisYap(id){
    kilitAc();
    setTimeout(()=>{ formAc(id); kilitKapat(); durum.textContent=""; },1500);
}

/* GEÃ‡Ä°Å BUTONLARI */
toLogin.onclick=()=>gecisYap("loginForm");
toRegister.onclick=()=>gecisYap("registerForm");
toReset.onclick=toReset2.onclick=()=>gecisYap("resetForm");
toLogin2.onclick=()=>gecisYap("loginForm");

/* ------------------------- KAYIT ------------------------- */
let kod = null;

regBtn.onclick = async()=>{
    kilitAc();

    const ad = regName.value.trim();
    const mail = regMail.value.trim();
    const pass = regPass.value.trim();
    const girKod = regCode.value.trim();

    if(!ad || !mail || !pass){
        kilitKapat(); durum.textContent="TÃ¼m alanlar gerekli."; return;
    }

    if(!kod){
        kod = Math.floor(100000+Math.random()*900000);
        await emailjs.send("service_vbm28pq","template_507m11j",{ kod, mail });
        kilitKapat();
        durum.textContent="Mailine kod gÃ¶nderildi.";
        return;
    }

    if(girKod != kod){
        kilitKapat(); durum.textContent="Kod yanlÄ±ÅŸ."; return;
    }

    /* Firebase UID Ã¼ret */
    const uid = "UID_" + Math.random().toString(36).substring(2,12);

    /* Åifreyi SHA-256 + salt(uid) */
    const hash = await sha256(pass + uid);

    await set(ref(db, "users/"+uid), {
        username: ad,
        mail: mail,
        pass: hash
    });

    localStorage.setItem("sessionUser", uid);

    durum.textContent = "KayÄ±t baÅŸarÄ±lÄ±!";
    setTimeout(()=> location.href="ana_site.html", 1200);
};

/* ------------------------- GÄ°RÄ°Å ------------------------- */
loginBtn.onclick = async()=>{
    kilitAc();
    const mail = loginMail.value.trim();
    const pass = loginPass.value.trim();

    const usersRef = ref(db,"users");
    const snap = await get(usersRef);

    if(!snap.exists()){
        kilitKapat(); durum.textContent="KayÄ±t yok."; return;
    }

    let bulundu=false;

    snap.forEach(child=>{
        const u = child.val();
        const uid = child.key;

        if(u.mail === mail){
            bulundu=true;
            sha256(pass + uid).then(hash=>{
                if(hash === u.pass){
                    localStorage.setItem("sessionUser", uid);
                    durum.textContent="GiriÅŸ baÅŸarÄ±lÄ±!";
                    setTimeout(()=> location.href="ana_site.html", 1200);
                } else {
                    kilitKapat(); durum.textContent="Åifre yanlÄ±ÅŸ!";
                }
            });
        }
    });

    if(!bulundu){
        kilitKapat();
        durum.textContent="Mail bulunamadÄ±.";
    }
};

/* ------------------ MÃœZÄ°K ------------------ */
const audio=document.getElementById("bgm");
const btn=document.getElementById("musicBtn");

btn.onclick=()=>{
    if(audio.paused){audio.play();btn.textContent="â¸ Durdur";}
    else{audio.pause();btn.textContent="â–¶ Oynat";}
};
</script>

</body>
</html>
