<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNIXSTORM</title>

<style>
    body {
        margin: 0;
        padding: 0;
        height: 100vh;
        background: url("3cc68b3f22ff5463843e82b661033950.jpg") no-repeat center center fixed;
        background-size: cover;
        font-family: "Arial";
    }

    .center-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 300px;
        padding: 22px;
        background: rgba(0,0,0,0.70);
        backdrop-filter: blur(6px);
        border-radius: 12px;
        color: white;
        text-align: center;
    }

    .center-box input {
        width: 100%;
        padding: 10px;
        margin: 7px 0;
        border-radius: 6px;
        border: none;
        outline: none;
    }

    .center-box button {
        width: 100%;
        padding: 10px;
        margin-top: 6px;
        border: none;
        border-radius: 6px;
        background: #006CFF;
        color: white;
        font-weight: bold;
        cursor: pointer;
    }

    .link-btn {
        margin-top: 8px;
        display: block;
        color: #ddd;
        cursor: pointer;
        text-decoration: underline;
        font-size: 14px;
    }

    #durum {
        margin-top: 10px;
        font-size: 14px;
        min-height: 20px;
        color: #fff;
    }
</style>
</head>

<body>

<!-- FORM KUTUSU -->
<div class="center-box">

  <!-- Kayıt Formu -->
  <div id="registerForm">
    <h3>Kayıt Ol</h3>

    <input type="text" id="regName" placeholder="Kullanıcı adı">
    <input type="email" id="regMail" placeholder="E-posta">
    <input type="password" id="regPass" placeholder="Şifre">

    <!-- PROFİL FOTO -->
    <input type="file" id="regPhoto">

    <button onclick="kayitOl()">Kayıt Ol</button>

    <span class="link-btn" onclick="formDegistir('login')">Giriş yapın</span>
    <span class="link-btn" onclick="formDegistir('reset')">Şifremi unuttum</span>
  </div>

  <!-- Giriş Formu -->
  <div id="loginForm" style="display:none;">
    <h3>Giriş Yap</h3>

    <input type="email" id="loginMail">
    <input type="password" id="loginPass">

    <button onclick="girisYap()">Giriş Yap</button>

    <span class="link-btn" onclick="formDegistir('register')">Kayıt olmak istiyorum</span>
  </div>

  <!-- Şifre Sıfırlama -->
  <div id="resetForm" style="display:none;">
    <h3>Şifre Sıfırla</h3>

    <input type="email" id="resetMail">
    <button onclick="sifreSifirla()">Gönder</button>

    <span class="link-btn" onclick="formDegistir('login')">Geri dön</span>
  </div>

  <div id="durum"></div>
</div>

<!-- FIREBASE -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { 
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendPasswordResetEmail 
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

import {
  getFirestore,
  setDoc,
  getDocs,
  collection,
  query,
  where,
  doc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

import {
  getStorage,
  ref,
  uploadBytes,
  getDownloadURL
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

const firebaseConfig = {
    apiKey: "AIzaSyC5X_RnBnhy2k-X6Y_lezHgWbgK31Y5Dao",
    authDomain: "unixstorm-9dff8.firebaseapp.com",
    projectId: "unixstorm-9dff8",
    storageBucket: "unixstorm-9dff8.appspot.com",   /* ✔ DOĞRU OLAN BU */
    messagingSenderId: "787509821542",
    appId: "1:787509821542:web:2b54b5bafee1207edeada7",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);
const storage = getStorage(app);

const durum = document.getElementById("durum");

/* FORM GEÇİŞİ */
window.formDegistir = function(target){
    durum.textContent = "Lütfen bekleyiniz...";
    setTimeout(() => {
        durum.textContent = "";

        document.getElementById("registerForm").style.display = "none";
        document.getElementById("loginForm").style.display = "none";
        document.getElementById("resetForm").style.display = "none";

        document.getElementById(target + "Form").style.display = "block";
    }, 1500);
};

/* KAYIT OL */
window.kayitOl = async function(){
    const ad = regName.value;
    const mail = regMail.value;
    const pass = regPass.value;
    const foto = regPhoto.files[0];

    durum.textContent = "Kontrol ediliyor...";

    try {
        const q = query(collection(db, "kullanicilar"), where("kullaniciAdi", "==", ad));
        const snapshot = await getDocs(q);

        if (!snapshot.empty) {
            durum.textContent = "Bu kullanıcı adı zaten var!";
            return;
        }

        durum.textContent = "Kayıt yapılıyor...";

        const cred = await createUserWithEmailAndPassword(auth, mail, pass);

        let photoURL = "";

        if (foto) {
            const sRef = ref(storage, "profil/" + cred.user.uid);
            await uploadBytes(sRef, foto);
            photoURL = await getDownloadURL(sRef);
        }

        await setDoc(doc(db, "kullanicilar", cred.user.uid), {
            kullaniciAdi: ad,
            email: mail,
            photoURL: photoURL,
            createdAt: new Date().toISOString()
        });

        durum.textContent = "Hesap oluşturuldu! Yönlendiriliyor...";
        setTimeout(() => location.href = "anasayfa.html", 1500);

    } catch(e){
        durum.textContent = "Hata: " + e.message;
    }
};

/* GİRİŞ */
window.girisYap = async function(){
    try {
        await signInWithEmailAndPassword(auth, loginMail.value, loginPass.value);
        durum.textContent = "Giriş başarılı!";
        setTimeout(() => location.href = "anasayfa.html", 1000);
    } catch(e){
        durum.textContent = "Hata: " + e.message;
    }
};

/* SIFIRLAMA */
window.sifreSifirla = async function(){
    try {
        await sendPasswordResetEmail(auth, resetMail.value);
        durum.textContent = "Mail gönderildi!";
    } catch(e){
        durum.textContent = e.message;
    }
};

</script>

<!-- MÜZİK BUTONU -->
<button id="musicBtn" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 12px 20px;
    font-size: 18px;
    border: none;
    border-radius: 10px;
    background: rgba(0,0,0,0.6);
    color: white;
    cursor: pointer;
">▶ Oynat</button>

<audio id="bgm">
    <source src="music.m4a" type="audio/mp4">
</audio>

<script>
let audio = document.getElementById("bgm");
let btn = document.getElementById("musicBtn");

btn.onclick = () => {
    if (audio.paused) {
        audio.play();
        btn.textContent = "⏸ Durdur";
    } else {
        audio.pause();
        btn.textContent = "▶ Oynat";
    }
};
</script>

</body>
</html>
