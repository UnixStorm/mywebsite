<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNIXSTORM â€” GiriÅŸ Sistemi</title>

<style>
body{
    margin:0;padding:0;height:100vh;
    background:url("3cc68b3f22ff5463843e82b661033950.jpg") no-repeat center center fixed;
    background-size:cover;font-family:Arial;
}
.yazi-kutu{text-align:center;margin-top:28px;}
.anaYazi{font-size:18px;color:white;font-weight:bold;text-shadow:0 0 6px white;}
.vip{color:orange;font-weight:bold;text-shadow:0 0 6px orange;}
.red{color:red;font-weight:bold;text-shadow:0 0 6px red;}

.center-box{
    position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
    width:280px;padding:20px;background:rgba(0,0,0,0.78);
    border-radius:12px;backdrop-filter:blur(5px);color:white;text-align:center;
}
.center-box input{
    width:100%;padding:10px;margin:6px 0;border:none;border-radius:8px;outline:none;
}
.center-box button{
    width:100%;padding:10px;margin-top:8px;border:none;border-radius:8px;
    background:#006CFF;font-weight:bold;color:white;cursor:pointer;
}
.link-btn{
    display:block;margin-top:8px;text-decoration:underline;
    color:#ddd;cursor:pointer;
}
#durum{
    margin-top:10px;min-height:22px;color:#ffebeb;font-weight:bold;font-size:14px;
}

#overlay {
    position: fixed;top: 0;left: 0;
    width: 100%;height: 100%;
    background: rgba(0,0,0,0.60);
    display:none;justify-content:center;align-items:center;
    z-index: 9999;
}
.loaderBox{
    background:rgba(0,0,0,0.85);
    padding:20px 30px;border-radius:12px;
    color:white;font-size:18px;text-align:center;
}
.loader{
    border:4px solid #fff;border-top:4px solid transparent;
    width:40px;height:40px;border-radius:50%;
    margin:auto;margin-bottom:10px;
    animation:spin 1s linear infinite;
}
@keyframes spin{100%{transform:rotate(360deg)}}
</style>
</head>
<body>

<!-- LOADING EKRANI -->
<div id="overlay">
    <div class="loaderBox">
        <div class="loader"></div>
        LÃ¼tfen bekleyiniz...
    </div>
</div>

<!-- ÃœST YAZI -->
<div class="yazi-kutu">
    <div class="anaYazi">ğğ® ğ¬ğ¢ğ­ğ ğ–£˜ğ”ğğˆğ—ğ’ğ“ğğ‘ğŒğŸ‡¹ğŸ‡· (ğ—¦ğ—”ğ—›ğ—¢ ğ—¥ğ—˜ğ—œğ—¦) á´›á´€Ê€á´€Ò“Ä±É´á´…á´€É´ á´‹á´œÊ€á´œÊŸá´á´œsÌ§á´›á´œÊ€</div>
    <div><span class="vip">ğ˜ƒğ—¶ğ—½_ğ˜‚ğ˜†ğ—²ğ—¹ğ—²ğ—¿ğŸ”± = </span><span class="red">ğŠğ€ğ€ğ ğ™ğğ‘ğğ€ & ğˆğğ…ğ€ğ™ ğ™ğğ‘ğğ€</span></div>
</div>

<!-- FORM KUTUSU -->
<div class="center-box">

    <!-- REGISTER -->
    <div id="registerForm">
        <h3>KayÄ±t Ol</h3>
        <input id="regName" placeholder="KullanÄ±cÄ± adÄ±">
        <input id="regMail" type="email" placeholder="E-posta">
        <input id="regPass" type="password" placeholder="Åifre">
        <input id="regCode" placeholder="E-postaya gelen kod">
        <button id="regBtn">KayÄ±t Ol</button>
        <span class="link-btn" id="toLogin">GiriÅŸ yapÄ±n</span>
    </div>

    <!-- LOGIN -->
    <div id="loginForm" style="display:none;">
        <h3>GiriÅŸ Yap</h3>
        <input id="loginMail" type="email" placeholder="E-posta">
        <input id="loginPass" type="password" placeholder="Åifre">
        <button id="loginBtn">GiriÅŸ Yap</button>
        <span class="link-btn" id="toRegister">KayÄ±t Ol</span>
        <span class="link-btn" id="toReset">Åifremi unuttum</span>
    </div>

    <!-- RESET SEND -->
    <div id="resetForm" style="display:none;">
        <h3>Åifre SÄ±fÄ±rlama</h3>
        <input id="resetMail" type="email" placeholder="E-posta">
        <button id="resetBtn">Kod GÃ¶nder</button>
        <span class="link-btn" id="toLogin2">GiriÅŸ yapÄ±n</span>
    </div>

    <!-- RESET CODE -->
    <div id="resetCodeForm" style="display:none;">
        <h3>Kodu DoÄŸrula</h3>
        <input id="resetCode" placeholder="Kod">
        <button id="resetCodeBtn">DoÄŸrula</button>
    </div>

    <!-- NEW PASSWORD -->
    <div id="newPassForm" style="display:none;">
        <h3>Yeni Åifre</h3>
        <input id="newPass" type="password" placeholder="Yeni ÅŸifre">
        <button id="newPassBtn">Kaydet</button>
    </div>

    <div id="durum"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script type="module">
/* ---------------------------------------------------
   ğŸ”¥ Firebase AyarlarÄ±
--------------------------------------------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, get, update, child } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC5X_RnBnhy2k-X6Y_lezHgWbgK31Y5Dao",
  authDomain: "unixstorm-9dff8.firebaseapp.com",
  projectId: "unixstorm-9dff8",
  storageBucket: "unixstorm-9dff8.firebasestorage.app",
  messagingSenderId: "787509821542",
  appId: "1:787509821542:web:2b54b5bafee1207edeada7",
  measurementId: "G-BQYS1575QZ",
  databaseURL: "https://unixstorm-9dff8-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

emailjs.init("dCQownkzENRARtTC_");

const durum = document.getElementById("durum");

/* ---------------------------------------------------
   ğŸ”¥ Loader
--------------------------------------------------- */
function yukle(ac=true){
    overlay.style.display = ac ? "flex" : "none";
}

/* ---------------------------------------------------
   ğŸ”¥ YardÄ±mcÄ± Fonksiyonlar
--------------------------------------------------- */
function emailValid(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }

async function sha256hex(str){
    const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
    return [...new Uint8Array(buf)].map(b => b.toString(16).padStart(2,"0")).join("");
}

function userKey(mail){
    return "user_" + btoa(mail).replace(/=/g,"");
}

function formAc(id){
    ["registerForm","loginForm","resetForm","resetCodeForm","newPassForm"]
    .forEach(f=>document.getElementById(f).style.display="none");
    document.getElementById(id).style.display="block";
}

/* ---------------------------------------------------
   ğŸ”¥ Form GeÃ§iÅŸleri
--------------------------------------------------- */
toLogin.onclick = ()=>formAc("loginForm");
toRegister.onclick = ()=>formAc("registerForm");
toReset.onclick = ()=>formAc("resetForm");
toLogin2.onclick = ()=>formAc("loginForm");

/* ---------------------------------------------------
   ğŸ”¥ KAYIT
--------------------------------------------------- */
let kayÄ±tKod = null;

regBtn.onclick = async()=>{
    yukle(true);

    const ad = regName.value.trim();
    const mail = regMail.value.trim();
    const pass = regPass.value;
    const girKod = regCode.value.trim();

    if(!ad || !mail || !pass){
        durum.textContent="Eksik bilgi!";
        yukle(false); return;
    }
    if(!emailValid(mail)){
        durum.textContent="E-posta hatalÄ±!";
        yukle(false); return;
    }

    const key = userKey(mail);

    if(!kayÄ±tKod){
        kayÄ±tKod = Math.floor(100000 + Math.random()*900000);

        await emailjs.send("service_vbm28pq","template_507m11j",{ kod:kayÄ±tKod, mail });

        durum.textContent = "Kod gÃ¶nderildi! E-postanÄ± kontrol et.";
        yukle(false);
        return;
    }

    if(String(girKod)!==String(kayÄ±tKod)){
        durum.textContent="Kod yanlÄ±ÅŸ!";
        yukle(false); return;
    }

    const hashed = await sha256hex(pass);

    await set(ref(db,"users/"+key),{
        kullaniciAdi:ad,
        email:mail,
        pass:hashed,
        createdAt:new Date().toLocaleString("tr-TR")
    });

    localStorage.setItem("sessionUser", key);

    durum.textContent="KayÄ±t baÅŸarÄ±lÄ±! YÃ¶nlendiriliyorsunuz...";
    yukle(false);

    setTimeout(()=>location.href="ana_site.html",1000);
};

/* ---------------------------------------------------
   ğŸ”¥ GÄ°RÄ°Å
--------------------------------------------------- */
loginBtn.onclick = async()=>{
    yukle(true);

    const mail = loginMail.value.trim();
    const pass = loginPass.value;

    if(!mail || !pass){
        durum.textContent="BoÅŸ bÄ±rakmayÄ±n!";
        yukle(false); return;
    }

    const key = userKey(mail);
    const snap = await get(child(ref(db),"users/"+key));

    if(!snap.exists()){
        durum.textContent="KullanÄ±cÄ± bulunamadÄ±.";
        yukle(false); return;
    }

    const hashed = await sha256hex(pass);

    if(hashed!==snap.val().pass){
        durum.textContent="Åifre yanlÄ±ÅŸ!";
        yukle(false); return;
    }

    localStorage.setItem("sessionUser", key);

    durum.textContent="GiriÅŸ baÅŸarÄ±lÄ±! YÃ¶nlendiriliyorsunuz...";
    yukle(false);

    setTimeout(()=>location.href="ana_site.html",900);
};

/* ---------------------------------------------------
   ğŸ”¥ ÅÄ°FRE SIFIRLAMA
--------------------------------------------------- */
let resetKod = null;
let resetMailKayit = null;

resetBtn.onclick = async()=>{
    yukle(true);

    const mail = resetMail.value.trim();
    if(!emailValid(mail)){
        durum.textContent="E-posta hatalÄ±!";
        yukle(false);
        return;
    }

    const key = userKey(mail);
    const snap = await get(child(ref(db),"users/"+key));

    if(!snap.exists()){
        durum.textContent="Bu mail kayÄ±tlÄ± deÄŸil!";
        yukle(false); return;
    }

    resetKod = Math.floor(100000+Math.random()*900000);
    resetMailKayit = mail;

    await emailjs.send("service_vbm28pq","template_507m11j",{ kod:resetKod, mail });

    durum.textContent="Kod gÃ¶nderildi!";
    yukle(false);
    formAc("resetCodeForm");
};

resetCodeBtn.onclick = ()=>{
    if(resetCode.value.trim()!==String(resetKod)){
        durum.textContent="Kod yanlÄ±ÅŸ!";
        return;
    }
    durum.textContent="Kod doÄŸrulandÄ±!";
    formAc("newPassForm");
};

newPassBtn.onclick = async()=>{
    yukle(true);

    const yeni = newPass.value.trim();
    if(!yeni){
        durum.textContent="BoÅŸ bÄ±rakÄ±lamaz!";
        yukle(false); return;
    }

    const key = userKey(resetMailKayit);
    const hashed = await sha256hex(yeni);

    await update(ref(db,"users/"+key),{ pass:hashed });

    durum.textContent="Åifre baÅŸarÄ±yla deÄŸiÅŸti!";
    yukle(false);

    formAc("loginForm");
};
</script>

</body>
    </html>
