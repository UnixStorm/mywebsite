<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UNIXSTORM - GiriÅŸ</title>

<!-- Firebase JS (module) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC5X_RnBnhy2k-X6Y_lezHgWbgK31Y5Dao",
    authDomain: "unixstorm-9dff8.firebaseapp.com",
    projectId: "unixstorm-9dff8",
    storageBucket: "unixstorm-9dff8.firebasestorage.app",
    messagingSenderId: "787509821542",
    appId: "1:787509821542:web:2b54b5bafee1207edeada7",
    measurementId: "G-BQYS1575QZ"
  };

  const app = initializeApp(firebaseConfig);
  window.auth = getAuth(app);
  window.db = getFirestore(app);
</script>

<style>
  :root{
    --card-w:340px;
    --neon: rgba(0,255,255,0.9);
  }
  html,body{height:100%;margin:0;padding:0;font-family:Inter,Arial,Helvetica,sans-serif}
  /* ARKA PLAN - raw github image (doÄŸru pathsa gelir) */
  body{
    background-image: url('https://raw.githubusercontent.com/UnixStorm/web-sitem/main/3cc68b3f22ff5463843e82b661033950.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;
  }

  /* ÃœST YAZILAR */
  .top-wrap{width:100%;text-align:center;padding-top:22px;pointer-events:none}
  .top-main{
    color:#ffffff;
    font-weight:700;
    text-shadow:0 0 14px rgba(0,255,255,.14);
    font-size:20px;
    margin-bottom:6px;
  }
  /* vip satÄ±rÄ±: sol turuncu, saÄŸ kÄ±rmÄ±zÄ± */
  .vip{
    font-weight:800;
    font-size:18px;
    letter-spacing:0.4px;
  }
  .vip .left{ color:#ff8900; text-shadow:0 0 10px rgba(255,137,0,.6) }
  .vip .and{ color:#ffffff; margin:0 6px; font-weight:700 }
  .vip .right{ color:#e81e1e; text-shadow:0 0 12px rgba(232,30,30,.45) }

  /* Kutu (kÃ¼Ã§Ã¼k, eski tasarÄ±m hissi) */
  .card{
    width:var(--card-w);
    max-width:90%;
    background:rgba(20,20,20,0.78);
    border-radius:14px;
    margin-top:36px;
    padding:20px;
    box-shadow:0 10px 40px rgba(0,200,255,0.08), 0 0 28px rgba(0,240,255,0.12);
    border:2px solid rgba(0,200,200,0.08);
    position:relative;
    color:#fff;
    backdrop-filter: blur(6px);
    transition: transform .35s ease, box-shadow .35s ease;
  }
  .card.small{ width:300px; padding:18px; border-radius:12px }
  .card:hover{ transform: translateY(-6px); box-shadow:0 18px 60px rgba(0,240,255,0.12) }

  .card h2{ text-align:center; margin:6px 0 12px; font-size:20px }
  input[type=text], input[type=email], input[type=password]{
    width:100%; padding:10px 12px; margin:8px 0; border-radius:8px; border:none; outline:none;
    font-size:14px;
  }
  .btn{
    display:block; width:100%; padding:11px; border-radius:8px; margin-top:12px; cursor:pointer;
    border:none; font-weight:700; color:white; background:linear-gradient(180deg,#12a0ff,#0077e6);
    box-shadow:0 6px 18px rgba(0,130,255,0.18);
  }
  .link{ color:rgba(255,255,255,0.9); display:block; text-align:center; margin-top:10px; text-decoration:underline; cursor:pointer; }
  .muted{ color:rgba(255,255,255,0.6); font-size:13px; text-align:center; margin-top:10px; }

  /* info banner while redirecting */
  .notice{
    text-align:center;
    margin-top:12px;
    color:#fff;
    background:rgba(0,0,0,0.35);
    padding:8px;border-radius:8px;
    display:none;
  }

  /* kÃ¼Ã§Ã¼k footer saÄŸ alt */
  .small-footer{
    position:fixed; right:12px; bottom:12px; background:rgba(255,255,255,0.04); padding:6px 10px; border-radius:8px;
    color:rgba(255,255,255,0.8); font-size:12px;
  }

  /* responsive */
  @media (min-width:900px){
    .card{ margin-top:80px; }
    .top-main{ font-size:22px }
  }
</style>
</head>
<body>

  <div class="top-wrap">
    <div class="top-main">[ğğ® ğ’ğ¢ğ­ğğ²ğ¢ ğ–£˜ğ”ğğˆÌ‡ğ—ğ’ğ“ğğ‘ğŒğŸ‡¹ğŸ‡· (ğ’ğ€ğ‡ğ) ğŠğ®ğ«ğ¦ğ®ğ¬ğ­ğ®ğ«]</div>
    <div class="vip">
      <span class="left">vip_uyelerğŸ”± = ğˆğğ…ğ€ğ™ ğ™ğğ‘ğğ€</span>
      <span class="and">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
      <span class="right">&nbsp; &amp; KAAN ZORBA</span>
    </div>
  </div>

  <div class="card" id="card">
    <h2 id="title">UNIXSTORM â€” KayÄ±t Ol</h2>

    <!-- register fields -->
    <div id="regFields">
      <input id="username" type="text" placeholder="KullanÄ±cÄ± adÄ± (her ÅŸey serbest)" />
      <input id="email" type="email" placeholder="E-posta (kod/link gÃ¶nderilecek)" />
      <input id="password" type="password" placeholder="Åifre" />
    </div>

    <!-- login fields (email+password only) -->
    <div id="loginFields" style="display:none">
      <input id="email_login" type="email" placeholder="E-posta" />
      <input id="password_login" type="password" placeholder="Åifre" />
    </div>

    <!-- reset fields (only email) -->
    <div id="resetFields" style="display:none">
      <input id="email_reset" type="email" placeholder="E-posta (sÄ±fÄ±rlama kodu/link iÃ§in)" />
    </div>

    <button id="actionBtn" class="btn">KayÄ±t Ol</button>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
      <span id="toggleLink" class="link">HesabÄ±n var mÄ±? GiriÅŸ yap</span>
      <span id="forgotLink" class="link">Åifremi unuttum</span>
    </div>

    <div id="info" class="muted">Not: KayÄ±t olunca doÄŸrulama e-postasÄ± (link) gÃ¶nderilecektir. DoÄŸruladÄ±ktan sonra giriÅŸ yapabilirsiniz.</div>

    <div id="notice" class="notice"></div>
  </div>

  <div class="small-footer">Â© UNIXSTORM</div>

<script type="module">
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const auth = window.auth;
  const db = window.db;

  // elements
  const title = document.getElementById('title');
  const regFields = document.getElementById('regFields');
  const loginFields = document.getElementById('loginFields');
  const resetFields = document.getElementById('resetFields');
  const actionBtn = document.getElementById('actionBtn');
  const toggleLink = document.getElementById('toggleLink');
  const forgotLink = document.getElementById('forgotLink');
  const notice = document.getElementById('notice');

  let mode = 'register'; // register | login | reset

  function showNotice(msg, time=4000){
    notice.style.display='block';
    notice.innerText = msg;
    setTimeout(()=>{ notice.style.display='none'; notice.innerText=''; }, time);
  }

  // toggle between register/login
  toggleLink.onclick = () => {
    if(mode === 'register'){
      mode = 'login';
      title.innerText = 'GiriÅŸ Yap';
      regFields.style.display = 'none';
      loginFields.style.display = 'block';
      resetFields.style.display = 'none';
      actionBtn.innerText = 'GiriÅŸ Yap';
      toggleLink.innerText = 'HesabÄ±n yok mu? KayÄ±t ol';
      forgotLink.style.display = 'inline';
      document.getElementById('info').innerText = 'GiriÅŸ yaparken e-posta doÄŸrulanmÄ±ÅŸ olmalÄ±dÄ±r.';
    } else if(mode === 'login'){
      mode = 'register';
      title.innerText = 'UNIXSTORM â€” KayÄ±t Ol';
      regFields.style.display = 'block';
      loginFields.style.display = 'none';
      resetFields.style.display = 'none';
      actionBtn.innerText = 'KayÄ±t Ol';
      toggleLink.innerText = 'HesabÄ±n var mÄ±? GiriÅŸ yap';
      forgotLink.style.display = 'inline';
      document.getElementById('info').innerText = 'Not: KayÄ±t olunca doÄŸrulama e-postasÄ± (link) gÃ¶nderilecektir. DoÄŸruladÄ±ktan sonra giriÅŸ yapabilirsiniz.';
    } else {
      // if in reset mode, go back to register
      mode = 'register';
      title.innerText = 'UNIXSTORM â€” KayÄ±t Ol';
      regFields.style.display = 'block';
      loginFields.style.display = 'none';
      resetFields.style.display = 'none';
      actionBtn.innerText = 'KayÄ±t Ol';
      toggleLink.innerText = 'HesabÄ±n var mÄ±? GiriÅŸ yap';
      forgotLink.style.display = 'inline';
      document.getElementById('info').innerText = 'Not: KayÄ±t olunca doÄŸrulama e-postasÄ± (link) gÃ¶nderilecektir. DoÄŸruladÄ±ktan sonra giriÅŸ yapabilirsiniz.';
    }
  };

  // forgot password -> switch to reset mode
  forgotLink.onclick = () => {
    mode = 'reset';
    title.innerText = 'Åifre SÄ±fÄ±rla';
    regFields.style.display = 'none';
    loginFields.style.display = 'none';
    resetFields.style.display = 'block';
    actionBtn.innerText = 'SÄ±fÄ±rlama Maili GÃ¶nder';
    forgotLink.style.display = 'none';
    toggleLink.innerText = 'Geri dÃ¶n';
    document.getElementById('info').innerText = 'E-posta girin, sÄ±fÄ±rlama linki gÃ¶nderilecektir.';
  };

  // helper: simple device id (not secure) - used to try to limit device->1 account
  function deviceId(){
    const raw = navigator.userAgent + '|' + navigator.platform + '|' + (navigator.languages || []).join(',');
    // simple hash
    let h=0; for(let i=0;i<raw.length;i++){ h = ((h<<5)-h) + raw.charCodeAt(i); h |= 0; }
    return 'd_'+Math.abs(h);
  }

  // action button handler
  actionBtn.onclick = async () => {
    if(mode === 'register'){
      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('email').value.trim();
      const pw = document.getElementById('password').value;

      if(!username || !email || !pw){ showNotice('TÃ¼m alanlarÄ± doldur.'); return; }

      // client-side device check (simple): only allow if localStorage not set
      if(localStorage.getItem('unixstorm_account_created')){
        showNotice('Bu cihazdan zaten bir hesap oluÅŸturulmuÅŸ.'); return;
      }

      try{
        actionBtn.disabled = true;
        actionBtn.innerText = 'KayÄ±t yapÄ±lÄ±yor...';
        const res = await createUserWithEmailAndPassword(auth, email, pw);
        const uid = res.user.uid;

        // store profile in Firestore (username + device)
        await setDoc(doc(db, 'users', uid), {
          username,
          email,
          device: deviceId(),
          createdAt: new Date().toISOString()
        });

        // mark localStorage so device cannot create another (basic)
        localStorage.setItem('unixstorm_account_created','1');

        // send verification email (link)
        await sendEmailVerification(res.user);

        showNotice('DoÄŸrulama e-posta linki gÃ¶nderildi. Maildeki linke tÄ±klayÄ±n.',8000);
        actionBtn.innerText = 'Mail GÃ¶nderildi';
        // after registration keep user on page until verify â€” they will be able to login after verifying
        setTimeout(()=>{ actionBtn.disabled=false; actionBtn.innerText='KayÄ±t Ol'; }, 3000);
      }catch(err){
        console.error(err);
        showNotice('KayÄ±t hatasÄ±: '+ (err.message||err.code) ,6000);
        actionBtn.disabled=false; actionBtn.innerText='KayÄ±t Ol';
      }

    } else if(mode === 'login'){
      const email = document.getElementById('email_login').value.trim();
      const pw = document.getElementById('password_login').value;
      if(!email || !pw){ showNotice('E-posta ve ÅŸifre girin.'); return; }
      try{
        actionBtn.disabled=true; actionBtn.innerText='GiriÅŸ yapÄ±lÄ±yor...';
        const res = await signInWithEmailAndPassword(auth, email, pw);
        const user = res.user;
        await user.reload();
        if(!user.emailVerified){
          showNotice('E-posta doÄŸrulanmamÄ±ÅŸ. LÃ¼tfen gelen maildeki linke tÄ±klayÄ±n.'); 
          actionBtn.disabled=false; actionBtn.innerText='GiriÅŸ Yap';
          return;
        }

        // login success -> show message then redirect after 5s to final page
        document.getElementById('info').innerText = 'GiriÅŸ baÅŸarÄ±lÄ± â€” yÃ¶nlendiriliyorsunuz...';
        actionBtn.innerText='BaÅŸarÄ±lÄ±';
        setTimeout(()=>{ window.location.href = 'sonkez_profildÃ¼zenleme.html'; }, 5000);

      }catch(err){
        console.error(err);
        showNotice('GiriÅŸ hatasÄ±: '+(err.message||err.code),5000);
        actionBtn.disabled=false; actionBtn.innerText='GiriÅŸ Yap';
      }

    } else if(mode === 'reset'){
      const email = document.getElementById('email_reset').value.trim();
      if(!email){ showNotice('E-posta girin.'); return; }
      try{
        actionBtn.disabled=true; actionBtn.innerText='GÃ¶nderiliyor...';
        // send password reset link
        await sendPasswordResetEmail(auth, email);
        showNotice('SÄ±fÄ±rlama maili gÃ¶nderildi. Maili kontrol edin.',6000);
        actionBtn.innerText='Mail GÃ¶nderildi';
        // after sending, show a little message and go back to login after 3s
        setTimeout(()=>{
          mode='login';
          title.innerText='GiriÅŸ Yap';
          regFields.style.display='none';
          loginFields.style.display='block';
          resetFields.style.display='none';
          actionBtn.innerText='GiriÅŸ Yap';
          toggleLink.innerText='HesabÄ±n yok mu? KayÄ±t ol';
          forgotLink.style.display='inline';
          document.getElementById('info').innerText='GiriÅŸ yaparken e-posta doÄŸrulanmÄ±ÅŸ olmalÄ±dÄ±r.';
          actionBtn.disabled=false;
        },3000);
      }catch(err){
        console.error(err);
        showNotice('Hata: '+(err.message||err.code),6000);
        actionBtn.disabled=false; actionBtn.innerText='SÄ±fÄ±rlama Maili GÃ¶nder';
      }
    }
  }; // actionBtn onclick

  // small UX: press Enter on inputs triggers action
  ['username','email','password','email_login','password_login','email_reset'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.addEventListener('keyup', (e)=>{ if(e.key==='Enter') actionBtn.click(); });
  });

  // On load: ensure card is compact like older design
  document.addEventListener('DOMContentLoaded', ()=>{ document.getElementById('card').classList.add('small'); });

</script>

</body>
</html>
